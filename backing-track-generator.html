<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Backing Track Generator</title>
  <link rel="stylesheet" href="backing-track-generator/styles.css" />
</head>
<body>
  <div class="bg-orbit"></div>
  <div class="bg-grid"></div>

  <header class="hero compact">
    <nav class="topbar compact">
      <div class="brand">
        <div>
          <div class="brand-title glow">BACKING TRACK GENERATOR</div>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <section id="practice" class="section">
      <div class="section-title compact-title"></div>

      <div class="grid practice-grid">
        <div class="card practice-hub">
          <div class="progression-block">
            <div class="key-row">
              <div class="key-pill-wrap">
                <button id="keyPill" class="key-banner" type="button" aria-expanded="false">Key: <span id="currentKey">C Major</span></button>
                <div id="keyPicker" class="key-picker" aria-hidden="true">
                  <div class="key-picker-section">
                    <div class="key-picker-label">Key</div>
                    <div id="keyPickerNotes" class="key-picker-notes"></div>
                  </div>
                  <div class="key-picker-section">
                    <div class="key-picker-label">Mode</div>
                    <div class="key-picker-modes">
                      <button data-mode="major" class="btn ghost small">Major</button>
                      <button data-mode="minor" class="btn ghost small">Minor</button>
                    </div>
                  </div>
                </div>
              </div>
              <button id="keyLockBtn" class="key-lock" type="button" aria-pressed="false">Lock</button>
              <div class="tempo-pill">
                <div class="tempo-label">Tempo</div>
                <div class="tempo-wrap funky">
                  <button id="tempoDown" class="tempo-step" type="button">-</button>
                  <input id="tempo" type="range" min="50" max="200" value="100" />
                  <button id="tempoUp" class="tempo-step" type="button">+</button>
                  <span id="tempoLabel">100 bpm</span>
                </div>
              </div>
              <div class="playback transport-mini">
                <button id="playBtn" class="btn primary play">Play</button>
                <button id="restartBtn" class="btn ghost">Restart</button>
                <button id="downloadMidi" class="btn ghost">Download MIDI</button>
              </div>
            </div>
            <div id="formChip" class="form-chip">Form: A x 2</div>
            <div class="progression-sections">
              <div class="progression-section" data-section="A">
                <div class="progression-section-head">A Section</div>
                <div id="progressionA" class="progression large"></div>
              </div>
              <div id="progressionSectionB" class="progression-section hidden" data-section="B">
                <div class="progression-section-head">B Section</div>
                <div id="progressionB" class="progression large"></div>
              </div>
            </div>
            <div class="progression-actions">
              <div class="progression-actions-left">
                <div class="note progression-hint">Drag to reorder • Tap × to remove</div>
              </div>
              <div class="progression-actions-right">
                <button id="saveProgression" class="btn ghost small">Save</button>
                <button id="loadProgression" class="btn ghost small">Load</button>
                <button id="deleteProgression" class="btn ghost small">Delete</button>
              </div>
            </div>
          </div>
          <details class="palette-drawer mobile-compact">
            <summary>Chord Palette (show/hide)</summary>
            <div class="palette">
              <!-- palette-head removed per request -->
              <div class="note palette-note">Tap or drag to add • Tap to audition</div>
              <details class="palette-section diatonic" open>
                <summary class="sub-title">Diatonic</summary>
                <div id="diatonicChords" class="chord-pool"></div>
              </details>
              <details class="palette-section extensions" open>
                <summary class="sub-title">With Extensions</summary>
                <div id="extendedChords" class="chord-pool"></div>
              </details>
              <details class="palette-section borrowed" open>
                <summary class="sub-title">Borrowed / Color</summary>
                <div id="borrowedChords" class="chord-pool"></div>
              </details>
            </div>
          </details>
          <div class="chord-editor">
            <div class="editor-header">Selected Chord</div>
            <div id="selectedChordLabel" class="selected-chord">Select a chord</div>
            <div class="editor-row">
              <div class="editor-label">Extensions</div>
              <div id="extensionButtons" class="editor-buttons"></div>
            </div>
            <div class="editor-row">
              <div class="editor-label">Duration (beats)</div>
              <div id="beatButtons" class="editor-buttons"></div>
            </div>
          </div>

          <div class="fretboard-block">
            <div class="fretboard-head">
              <label class="toggle compact">
                Show fretboard
                <input id="fretToggle" type="checkbox" checked />
              </label>
            </div>
            <div class="fretboard-wrapper">
              <div id="fretboardMarkers" class="fretboard-markers"></div>
              <div id="fretboardGrid" class="fretboard"></div>
            </div>
            <div id="countIn" class="count-in" aria-live="polite">
              <span data-count="1">1</span>
              <span data-count="2">2</span>
              <span data-count="3">3</span>
              <span data-count="4">4</span>
            </div>
          </div>
        </div>

      </div>

      <div class="card builder">
        <div class="control-row section-control-row">
          <button id="editSectionA" class="btn ghost small active">Edit A</button>
          <button id="addBSection" class="btn ghost small">Add B Section</button>
          <button id="editSectionB" class="btn ghost small" disabled>Edit B</button>
          <label>
            A Loops
            <select id="aRepeats">
              <option value="1">1</option>
              <option value="2" selected>2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
            </select>
          </label>
          <label>
            B Loops
            <select id="bRepeats">
              <option value="1">1</option>
              <option value="2" selected>2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
            </select>
          </label>
        </div>
        <div class="preset-row">
          <button id="presetOneChord" class="btn ghost small">One Chord Backing Track</button>
          <button id="presetBlues" class="btn ghost small">12 Bar Blues</button>
          <button id="presetFamous" class="btn ghost small">Famous Progression</button>
          <button id="presetIIVI" class="btn ghost small">ii–V–I Turnaround</button>
          <button id="presetMinorLoop" class="btn ghost small">Minor Loop</button>
        </div>
        <div class="generator">
          <div class="generator-row">
            <div class="control-row">
              <label>
                Length
                <select id="genLength">
                  <option value="4">4 chords</option>
                  <option value="6">6 chords</option>
                  <option value="8">8 chords</option>
                </select>
              </label>
              <label>
                Spice Level
                <select id="genSpice">
                  <option value="none">None</option>
                  <option value="light" selected>Light</option>
                  <option value="bold">Bold</option>
                </select>
              </label>
              <label>
                Rhythm Feel
                <select id="genRhythm">
                  <option value="steady">Steady (4 beats)</option>
                  <option value="mixed">Mixed (1–4 beats)</option>
                  <option value="short">Short (1–2 beats)</option>
                  <option value="long">Long (4–8 beats)</option>
                  <option value="pulse">Quarter Pulse</option>
                  <option value="drive">Eighth Drive</option>
                  <option value="syncopated">Syncopated</option>
                  <option value="offbeat">Offbeat Pulse</option>
                  <option value="split">High/Low Comp</option>
                  <option value="answer">Call + Answer</option>
                  <option value="chop">Backbeat Chop</option>
                  <option value="push">Push Accents</option>
                  <option value="tresillo">Tresillo</option>
                  <option value="habanera">Habanera</option>
                  <option value="clave">Clave</option>
                  <option value="sparse">Sparse Hits</option>
                </select>
              </label>
            </div>
            <button id="generateProg" class="btn primary play">Generate Chord Progression</button>
          </div>
        </div>

        <details class="details builder-details">
          <summary>Here be dragons...</summary>
          <div class="control-row">
            <label>
              Key
              <select id="keySelect">
                <option value="random">Random</option>
              </select>
            </label>
            <label>
              Mode
              <select id="modeSelect">
                <option value="random">Random</option>
                <option value="major">Major</option>
                <option value="minor">Minor</option>
              </select>
            </label>
            <label>
              Backing Vibe
              <select id="styleSelect">
                <option value="random">Random</option>
                <option value="clean">Clean Pop</option>
                <option value="neosoul">Neo-Soul</option>
                <option value="jazz">Jazz Club</option>
                <option value="cinematic">Cinematic</option>
              </select>
            </label>
            <label>
              Recent Pop/Rock
              <select id="progressionSelect">
                <option value="">Select a progression</option>
              </select>
            </label>
          </div>
          <div class="note">Backing vibe sets the tone, rhythm feel, and drum pattern.</div>

          <div class="progression-tools">
            <div>
              <div class="sub-title">Edit Progression</div>
              <div class="progression-input">
                <input id="progInput" type="text" placeholder="Type: I vi IV V" />
                <button id="applyProg" class="btn ghost small">Apply</button>
              </div>
              <div class="note">Tip: add durations with `:2` (e.g., `V:2`) for 2 beats. Default is 1 beat.</div>
              <div class="spicy-row">
                <div>
                  <div class="spicy-title">Spicy Suggestion</div>
                  <div id="spicySuggestion" class="spicy-pill">—</div>
                </div>
                <div class="spicy-actions">
                  <button id="addSpicy" class="btn ghost small">Add</button>
                  <button id="refreshSpicy" class="btn ghost small">New</button>
                </div>
              </div>
              <div class="progression-actions">
                <button id="clearProg" class="btn ghost small">Clear</button>
                <button id="shuffleProg" class="btn ghost small">Swap Order</button>
              </div>
            </div>
          </div>

          <div class="control-row">
            <label>
              Chord Texture
              <select id="textureSelect">
                <option value="block">Block Chords</option>
                <option value="arp">Arpeggiated</option>
                <option value="pulse">Pulse Comp</option>
                <option value="split">Split Comp (High/Low)</option>
              </select>
            </label>
            <label>
              Chord Size
              <select id="sizeSelect">
                <option value="triad">Triads</option>
                <option value="seventh">Sevenths</option>
              </select>
            </label>
            <label>
              Chord Rhythm
              <select id="rhythmSelect">
                <option value="whole">Whole Notes</option>
                <option value="halves">Half Notes</option>
                <option value="quarters">Quarter Pulse</option>
                <option value="eighths">Eighth Drive</option>
                <option value="rockStrum">Rock Strum</option>
                <option value="syncopated">Syncopated</option>
                <option value="offbeat">Offbeat Pulse</option>
                <option value="answer">Call + Answer</option>
                <option value="split">High/Low Comping</option>
                <option value="chop">Backbeat Chop</option>
                <option value="push">Push Accents</option>
                <option value="tresillo">Tresillo</option>
                <option value="habanera">Habanera</option>
                <option value="clave">Clave</option>
                <option value="sparse">Sparse Hits</option>
              </select>
            </label>
            <label>
              Instrument
              <select id="instrumentSelect">
                <option value="piano" selected>Piano</option>
                <option value="guitar_clean">Guitar Clean</option>
                <option value="guitar_crunch">Guitar Crunch</option>
                <option value="guitar_heavy">Guitar Heavy</option>
                <option value="synth">Synth Pad</option>
              </select>
            </label>
            <label class="toggle">
              Realistic Guitar
              <input id="realisticGuitarToggle" type="checkbox" checked />
              <span>Enabled</span>
            </label>
            <label class="toggle">
              Drums
              <input id="drumToggle" type="checkbox" checked />
              <span>Enabled</span>
            </label>
            <label class="toggle">
              Bass
              <input id="bassToggle" type="checkbox" checked />
              <span>Enabled</span>
            </label>
            <label>
              Bass Rhythm
              <select id="bassRhythmSelect">
                <option value="steady" selected>Steady (1 & 3)</option>
                <option value="eighths">Eighth Pulse</option>
                <option value="syncopated">Syncopated</option>
                <option value="offbeat">Offbeat</option>
                <option value="tresillo">Tresillo</option>
                <option value="push">Push Accents</option>
                <option value="oneDrop">Reggae One-Drop</option>
                <option value="motown">Motown</option>
                <option value="walking">Walking</option>
              </select>
            </label>
          </div>
          <div class="slider-group">
            <label>
              Tone Warmth
              <input id="toneSlider" type="range" min="400" max="2400" value="1200" />
            </label>
            <label>
              Note Hold
              <input id="holdSlider" type="range" min="0.6" max="2.5" step="0.1" value="1.4" />
            </label>
            <label>
              Piano Timing
              <div class="level-row">
                <input id="sampleOffset" type="range" min="-120" max="120" step="1" value="-7" />
                <span id="pianoTimingValue">-7ms</span>
              </div>
            </label>
            <label>
              Sample Trim
              <input id="sampleTrim" type="range" min="0" max="300" step="10" value="280" />
            </label>
            <label>
              Piano Level
              <div class="level-row">
                <input id="pianoLevel" type="range" min="0" max="100" step="1" value="55" />
                <span id="pianoLevelValue">55%</span>
              </div>
            </label>
            <label>
              Guitar Level
              <div class="level-row">
                <input id="guitarLevel" type="range" min="0" max="100" step="1" value="30" />
                <span id="guitarLevelValue">30%</span>
              </div>
            </label>
            <label>
              Drum Level
              <input id="drumLevel" type="range" min="0" max="100" step="1" value="55" />
            </label>
            <label>
              Bass Level
              <input id="bassLevel" type="range" min="0" max="100" step="1" value="35" />
            </label>
            <label>
              Bass Timing
              <div class="level-row">
                <input id="bassTiming" type="range" min="-120" max="120" step="1" value="-6" />
                <span id="bassTimingValue">-6ms</span>
              </div>
            </label>
            <button id="resetSliders" class="btn ghost small">Reset sliders</button>
            <div class="latency-test">
              <button id="runLatencyTest" class="btn ghost small">Run latency test</button>
              <div id="latencyResult" class="note">Latency test: —</div>
            </div>
          </div>
          <div class="control-row">
            <label>
              Drum Style
              <select id="drumStyleSelect">
                <option value="random">Random</option>
                <option value="pop" selected>Pop/Rock</option>
                <option value="electronic">Electronic</option>
                <option value="edm">EDM</option>
                <option value="industrial">Industrial</option>
                <option value="african">African</option>
                <option value="clave">Clave</option>
                <option value="bossa">Bossa Nova</option>
                <option value="jazz">Jazz</option>
                <option value="cinematic">Cinematic</option>
              </select>
            </label>
          </div>
          <div class="auto-align">
            <button id="autoAlignSamples" class="btn ghost small">Auto-align samples</button>
            <div class="note">Analyzes the current instrument sample and sets trim/offset.</div>
          </div>

          <div class="note">Sampled backing + optional drums to keep the focus on phrasing.</div>
        </details>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-meta">Total practice minutes: <span id="footerMinutes">0</span></div>
    <button id="resetMinutes" class="btn ghost small">Reset practice minutes</button>
    <div class="footer-attribution">CC BY 3.0: Pearl Master Studio • CR-78 Public Domain (via oramics)</div>
  </footer>

  <div class="mobile-transport">
    <button id="mobilePlay" class="btn primary play">Play</button>
    <div class="mobile-tempo">
      <button id="tempoDownMobile" class="tempo-step" type="button">-</button>
      <span id="tempoLabelMobile">100 bpm</span>
      <button id="tempoUpMobile" class="tempo-step" type="button">+</button>
    </div>
    <div class="mobile-key" id="mobileKey">Key: C Major</div>
  </div>

  <script src="backing-track-generator/app.js"></script>
</body>
</html>
